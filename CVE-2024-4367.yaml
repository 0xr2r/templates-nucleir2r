
id: CVE-2024-4367

info:
  name: Odoo PDF.js affected by CVE-2024-4367 allowing arbitrary JavaScript execution
  author: 0xr2r
  severity: high
  description: |
    Vulnerable PDF.js (pdfjs-dist versions lower than 4.2.67) uses eval() to process fonts when rendering PDFs. This can allow attackers to execute arbitrary JavaScript 
    by providing a specially crafted PDF. Disabling isEvalSupported or updating to version 4.2.67 or higher mitigates this issue.
  impact: |
    Vulnerable PDF.js can allow arbitrary JavaScript execution when opening manipulated PDFs.
  remediation: |
    Update PDF.js (pdfjs-dist) to 4.2.67 or higher, or disable isEvalSupported (may affect interactive PDFs).
  reference:
    - https://lists.debian.org/debian-lts-announce/2024/05/msg00012.html
    - https://security.snyk.io/vuln/SNYK-JS-PDFJSDIST-6810403


http:
  - method: GET
    path:
      - "{{BaseURL}}/web/static/lib/pdfjs/web/pdf.js"
      - "{{BaseURL}}/web/static/lib/pdfjs/web/pdf.worker.js"
      - "{{BaseURL}}/web/static/lib/pdfjs/build/pdf.js"
      - "{{BaseURL}}/web/static/lib/pdfjs/build/pdf.worker.js"
      - "{{BaseURL}}/web/static/lib/pdfjs/build/pdf.min.js"
      - "{{BaseURL}}/web/static/lib/pdfjs/build/pdf.worker.min.js"
      - "{{BaseURL}}/web/static/lib/pdfjs-dist/web/pdf.js"
      - "{{BaseURL}}/web/static/lib/pdfjs-dist/web/pdf.worker.js"
      - "{{BaseURL}}/web/static/lib/pdfjs-dist/build/pdf.js"
      - "{{BaseURL}}/web/static/lib/pdfjs-dist/build/pdf.worker.js"
      - "{{BaseURL}}/web/static/lib/pdfjs-dist/build/pdf.min.js"
      - "{{BaseURL}}/web/static/lib/pdfjs-dist/build/pdf.worker.min.js"
      - "{{BaseURL}}/web/static/lib/pdfjs/web/viewer.html"
    matchers-condition: or
    matchers:
      - type: regex
        part: body
        regex:
          - "pdfjsVersion\\s*[:=]\\s*['\"]?(0\\.[0-9]{1,2}\\.[0-9]{1,3}|[1-3]\\.[0-9]{1,2}\\.[0-9]{1,3}|4\\.[0-2]\\.(?:[0-5]?[0-9]|6[0-6]))['\"]?"
      - type: regex
        part: body
        regex:
          - "PDF\\.js v(0\\.[0-9]{1,2}\\.[0-9]{1,3}|[1-3]\\.[0-9]{1,2}\\.[0-9]{1,3}|4\\.[0-2]\\.(?:[0-5]?[0-9]|6[0-6]))"